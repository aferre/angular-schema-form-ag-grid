angular.module("schemaForm").run(["$templateCache",function(t){t.put("directives/decorators/bootstrap/aggrid/aggridselect.html",'<div ng-controller="agGridSelectController" class="form-group {{form.htmlClass}}" ng-class="{\'has-error\': hasError(), \'has-success\': hasSuccess()}"><label class="control-label {{form.labelHtmlClass}}" ng-show="showTitle()">{{form.title}}</label><div class="form-group {{form.fieldHtmlClass}}"><input ag-grid-select="" type="hidden" class="btn btn-default" sf-changed="form" schema-validate="form" ng-model="$$value$$"><div>{{\'Filter\'|translate}}: <input placeholder="{{\'Criteria...\'|translate}}" type="text" ng-model="chargerFilter" ng-paste="onFilterChanged(chargerFilter)" ng-change="onFilterChanged(chargerFilter)"> <button class="btn btn-default" ng-click="selectAll(true)">{{ \'Select all\' | translate }}</button> <button class="btn btn-default" ng-click="selectAll(false)">{{ \'Deselect all\' | translate }}</button></div><div style="height: 200px;"><div ag-grid="gridOptions" class="ag-fresh" style="height: 100%;"></div></div><span class="help-block">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span></div></div>')}]),angular.module("schemaForm").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider",function(t,e,o){var i=function(e,i,n){if("string"===i.type&&"enum"in i){var a=t.stdFormObj(e,i,n);return a.key=n.path,a.type="strapselect",n.lookup[o.stringify(n.path)]=a,a}};t.defaults.string.unshift(i),e.addMapping("bootstrapDecorator","aggridselect","directives/decorators/bootstrap/aggrid/aggridselect.html")}]).directive("agGridSelect",function(){return{require:["ngModel"],restrict:"A",scope:{},controller:["$scope",function(t){t.$parent.$watch("agGridData_model",function(){void 0!=t.$parent.agGridData_model&&(t.$parent.insideModel=t.$parent.agGridData_model,t.$parent.ngModel.$setViewValue(t.$parent.agGridData_model))})}],link:function(t,e,o,i){t.ngModel=i}}}),angular.module("schemaForm").controller("agGridSelectController",["$scope","$http","$timeout",function(t,e,o){t.form.options||(t.form.options={}),t.agGridData_model={},t.chargerFilter="";var i=t.form.key,n=t.$parent.$parent.$parent.model;for(var a in i)n=n[i[a]];n&&(t.agGridData_model=n),console.log("Setting options."+t.form.options.toString()),t.form.options.scope=t,t.onGridReadyCB=function(){console.log("Grid ready for init"),t.populateList(t.form);var e=t.ngModel;t.$parent;console.log(e)},t.onFilterChanged=function(e){t.gridOptions.api.setQuickFilter(e)},t.getCallback=function(e){if("string"==typeof e){var o=t.$parent.evalExpr(e);if("function"==typeof o)return o;throw"A callback string must match name of a function in the parent scope"}if("function"==typeof e)return e;throw"A callback must either be a string matching the name of a function in the parent scope or a direct function reference"};var r=[];t.form.options.columnDefs&&(r=t.getCallback(t.form.options.columnDefs)()),console.log("initing gridOptions");var l=[{headerValueGetter:function(t){return""},width:30,checkboxSelection:!0}],s=l.concat(r);t.gridOptions={columnDefs:s,angularCompileRows:!0,enableFilter:!0,enableSorting:!0,enableColResize:!0,rowHeight:30,rowSelection:"multiple",multiSelect:!0,onReady:function(e){console.log("ag grid on ready "+e),t.onGridReadyCB()},onGridReady:function(){t.onGridReadyCB()},onSelectionChanged:function(){t.initingGridFromList||t.onSelectionChanged()}},t.onSelectionChanged=function(){var e=t.gridOptions.api.getSelectedRows();t.selectedItems=e,console.log("onselectionchanged "+JSON.stringify(t.selectedItems));t.$parent;t.form.options.postSelection&&(e=t.getCallback(t.form.options.postSelection)(e)),t.agGridData_model=e;t.ngModel},t.triggerinitialData=function(){console.log("listener triggered"),t.form.initialData.push({value:"345890u340598u3405u9",name:"34095u3p4ouij"}),o(function(){t.form.initialData.pop()})},t.initFiltering=function(e){t.form.options.filterTriggers&&t.form.options.filterTriggers.forEach(function(e){t.$parent.$watch(e,t.triggerinitialData)}),t.localModelType=Object.prototype.toString.call(e),t.filteringInitialized=!0},t.finalizeList=function(e,o,i){if(i&&"map"in i&&i.map){var n=i.map.nameProperty.length-1,a=i.map.separatorValue?i.map.separatorValue:" - ";o.forEach(function(t){if(t.value=t[i.map.valueProperty],"string"!=typeof i.map.nameProperty){var o="";for(var r in i.map.nameProperty)o+=t[i.map.nameProperty[r]],r!=n&&(o+=a);t.name=o}else t.name=t[i.map.nameProperty];e.initialData.push(t)})}else o.forEach(function(t){"text"in t&&(t.name=t.text)}),e.initialData=o,t.gridOptions.api.setRowData(o);if(t.agGridData_model){t.initingGridFromList=!0;for(var r in t.agGridData_model){var l=t.agGridData_model[r];if(l){var s=!0;t.gridOptions.api.forEachNode(function(e,o){s&&(console.log("Comparing row "+e+" to "+JSON.stringify(l)),t.form.options.compareFunction?t.getCallback(t.form.options.compareFunction)(e.data,l)&&(t.gridOptions.api.selectNode(e,!0),console.log("Selecting row "+e),s=!1):e.data.id==l.id&&(t.gridOptions.api.selectNode(e,!0),s=!1))})}}t.initingGridFromList=!1}t.internalModel&&(console.log("Call uiMultiSelectInitInternalModel"),t.uiMultiSelectInitInternalModel(t.externalModel))},t.clone=function(e){if(null==e||"object"!=typeof e)return e;var o=e.constructor();for(var i in e)e[i]!=t&&e.hasOwnProperty(i)&&(o[i]=t.clone(e[i]));return o},t.selectAll=function(e){e?t.gridOptions.api.selectAll():t.gridOptions.api.deselectAll()},t.selectAllAfterFilter=function(e){t.gridOptions.api.forEachNodeAfterFilter(function(o,i){e?t.gridOptions.api.selectNode(o,!0,!0):t.gridOptions.api.deselectNode(o,!0,!0)}),t.onSelectionChanged()},t.getOptions=function(e,o){return e.httpPost&&e.httpPost.optionsCallback?(newOptionInstance=t.clone(e),t.getCallback(e.httpPost.optionsCallback)(newOptionInstance,o)):e.httpGet&&e.httpGet.optionsCallback?(newOptionInstance=t.clone(e),t.getCallback(e.httpGet.optionsCallback)(newOptionInstance,o)):e},t.test=function(t){t.initialData.pop()},t.populateList=function(o,i){if(o.schema&&"enum"in o.schema)o.initialData=[],o.schema["enum"].forEach(function(t){o.initialData.push({value:t,name:t})});else if(o.options)if(o.options.callback)o.initialData=t.getCallback(o.options.callback)(o.options,i),t.finalizeList(o,o.initialData,o.options),console.log("callback items: ",o.initialData);else{if(o.options.asyncCallback)return t.getCallback(o.options.asyncCallback)(o.options,i).then(function(e){e=e.data||e,t.finalizeList(o,e,o.options),console.log("asyncCallback items",o.initialData)},function(e,i){o.options.onPopulationError?t.getCallback(o.options.onPopulationError)(o,e,i):alert("Loading select items failed(Options: '"+String(o.options)+"\nError: "+i)});if(o.options.httpPost){var n=t.getOptions(o.options,i);return e.post(n.httpPost.url,n.httpPost.parameter).then(function(e){t.finalizeList(o,e.data,n),console.log("httpPost items",o.initialData)},function(e,i){o.options.onPopulationError?t.getCallback(o.options.onPopulationError)(o,e,i):alert("Loading select items failed (URL: '"+String(n.httpPost.url)+"' Parameter: "+String(n.httpPost.parameter)+"\nError: "+i)})}if(o.options.httpGet){var n=t.getOptions(o.options,i);return e.get(n.httpGet.url,n.httpGet.parameter).then(function(e){t.finalizeList(o,e.data,n),console.log("httpGet items",o.initialData)},function(e,i){o.options.onPopulationError?t.getCallback(o.options.onPopulationError)(o,e,i):alert("Loading select items failed (URL: '"+String(n.httpGet.url)+"\nError: "+i)})}t.insideModel&&void 0===t.agGridData_model.selected&&(t.agGridData_model.selected=t.find_in_initialData(t.insideModel))}else console.log("dynamicSelectController.populateinitialData(key:"+o.key+") : No options set, needed for dynamic selects")},t.find_in_initialData=function(e){for(a=0;a<t.form.initialData.length;a++)if(t.form.initialData[a].value==e)return{item:t.form.initialData[a],index:a}}}]);