angular.module("schemaForm").run(["$templateCache",function(t){t.put("directives/decorators/bootstrap/aggrid/aggridselect.html",'<div ng-controller="agGridSelectController" class="form-group {{form.htmlClass}}" ng-class="{\'has-error\': hasError(), \'has-success\': hasSuccess()}"><label class="control-label {{form.labelHtmlClass}}" ng-show="showTitle()">{{form.title}}</label><div class="form-group {{form.fieldHtmlClass}}"><input ag-grid-select="" type="hidden" class="btn btn-default" sf-changed="form" schema-validate="form" ng-model="$$value$$"><div><button class="btn btn-default" ng-click="selectAll(true)">{{ \'Select all\' | translate }}</button> <button class="btn btn-default" ng-click="selectAll(false)">{{ \'Deselect all\' | translate }}</button></div><div style="height: 200px;"><div ag-grid="gridOptions" class="ag-fresh" style="height: 100%;"></div></div><span class="help-block">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span></div></div>')}]),angular.module("schemaForm").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider",function(t,e,o){var a=function(e,a,i){if("string"===a.type&&"enum"in a){var n=t.stdFormObj(e,a,i);return n.key=i.path,n.type="strapselect",i.lookup[o.stringify(i.path)]=n,n}};t.defaults.string.unshift(a),e.addMapping("bootstrapDecorator","aggridselect","directives/decorators/bootstrap/aggrid/aggridselect.html")}]).directive("agGridSelect",function(){return{require:["ngModel"],restrict:"A",scope:{},controller:["$scope",function(t){t.$parent.$watch("agGridData_model",function(){void 0!=t.$parent.agGridData_model&&(t.$parent.insideModel=t.$parent.agGridData_model,t.$parent.ngModel.$setViewValue(t.$parent.agGridData_model))})}],link:function(t,e,o,a){t.ngModel=a}}}),angular.module("schemaForm").controller("agGridSelectController",["$scope","$http","$timeout",function(t,e,o){t.form.options||(t.form.options={}),t.agGridData_model={};var a=t.form.key,i=t.$parent.$parent.$parent.model;for(var n in a)i=i[a[n]];i&&(t.agGridData_model=i),console.log("Setting options."+t.form.options.toString()),t.form.options.scope=t,t.onGridReadyCB=function(){console.log("Grid ready for init"),t.populateList(t.form);var e=t.ngModel;t.$parent;console.log(e)},t.getCallback=function(e){if("string"==typeof e){var o=t.$parent.evalExpr(e);if("function"==typeof o)return o;throw"A callback string must match name of a function in the parent scope"}if("function"==typeof e)return e;throw"A callback must either be a string matching the name of a function in the parent scope or a direct function reference"};var r=[];t.form.options.columnDefs&&(r=t.getCallback(t.form.options.columnDefs)()),console.log("initing gridOptions"),t.gridOptions={columnDefs:r,angularCompileRows:!0,enableFilter:!0,enableSorting:!0,enableColResize:!0,rowHeight:30,rowSelection:"multiple",multiSelect:!0,onReady:function(e){console.log("ag grid on ready "+e),t.onGridReadyCB()},onGridReady:function(){t.onGridReadyCB()},onSelectionChanged:function(){var e=t.gridOptions.api.getSelectedRows();t.selectedItems=e;t.$parent;t.getCallback,t.form.options.postSelection&&(e=t.getCallback(t.form.options.postSelection)(e)),t.agGridData_model=e;t.ngModel}},t.triggerinitialData=function(){console.log("listener triggered"),t.form.initialData.push({value:"345890u340598u3405u9",name:"34095u3p4ouij"}),o(function(){t.form.initialData.pop()})},t.initFiltering=function(e){t.form.options.filterTriggers&&t.form.options.filterTriggers.forEach(function(e){t.$parent.$watch(e,t.triggerinitialData)}),t.localModelType=Object.prototype.toString.call(e),t.filteringInitialized=!0},t.finalizeList=function(e,o,a){if(a&&"map"in a&&a.map){var i=a.map.nameProperty.length-1,n=a.map.separatorValue?a.map.separatorValue:" - ";o.forEach(function(t){if(t.value=t[a.map.valueProperty],"string"!=typeof a.map.nameProperty){var o="";for(var r in a.map.nameProperty)o+=t[a.map.nameProperty[r]],r!=i&&(o+=n);t.name=o}else t.name=t[a.map.nameProperty];e.initialData.push(t)})}else o.forEach(function(t){"text"in t&&(t.name=t.text)}),e.initialData=o,t.gridOptions.api.setRowData(o);t.agGridData_model&&t.gridOptions.api.forEachNode(function(e,o){for(var a in t.agGridData_model){var i=t.agGridData_model[a];void 0!==i&&(console.log("Comparing row "+e+" to "+JSON.stringify(i)),e.data.id==i.id&&t.gridOptions.api.selectNode(e))}}),t.internalModel&&(console.log("Call uiMultiSelectInitInternalModel"),t.uiMultiSelectInitInternalModel(t.externalModel))},t.clone=function(e){if(null==e||"object"!=typeof e)return e;var o=e.constructor();for(var a in e)e[a]!=t&&e.hasOwnProperty(a)&&(o[a]=t.clone(e[a]));return o},t.selectAll=function(e){e?t.gridOptions.api.selectAll():t.gridOptions.api.deselectAll()},t.getOptions=function(e,o){return e.httpPost&&e.httpPost.optionsCallback?(newOptionInstance=t.clone(e),t.getCallback(e.httpPost.optionsCallback)(newOptionInstance,o)):e.httpGet&&e.httpGet.optionsCallback?(newOptionInstance=t.clone(e),t.getCallback(e.httpGet.optionsCallback)(newOptionInstance,o)):e},t.test=function(t){t.initialData.pop()},t.populateList=function(o,a){if(o.schema&&"enum"in o.schema)o.initialData=[],o.schema["enum"].forEach(function(t){o.initialData.push({value:t,name:t})});else if(o.options)if(o.options.callback)o.initialData=t.getCallback(o.options.callback)(o.options,a),t.finalizeList(o,o.initialData,o.options),console.log("callback items: ",o.initialData);else{if(o.options.asyncCallback)return t.getCallback(o.options.asyncCallback)(o.options,a).then(function(e){e=e.data||e,t.finalizeList(o,e,o.options),console.log("asyncCallback items",o.initialData)},function(e,a){o.options.onPopulationError?t.getCallback(o.options.onPopulationError)(o,e,a):alert("Loading select items failed(Options: '"+String(o.options)+"\nError: "+a)});if(o.options.httpPost){var i=t.getOptions(o.options,a);return e.post(i.httpPost.url,i.httpPost.parameter).then(function(e){t.finalizeList(o,e.data,i),console.log("httpPost items",o.initialData)},function(e,a){o.options.onPopulationError?t.getCallback(o.options.onPopulationError)(o,e,a):alert("Loading select items failed (URL: '"+String(i.httpPost.url)+"' Parameter: "+String(i.httpPost.parameter)+"\nError: "+a)})}if(o.options.httpGet){var i=t.getOptions(o.options,a);return e.get(i.httpGet.url,i.httpGet.parameter).then(function(e){t.finalizeList(o,e.data,i),console.log("httpGet items",o.initialData)},function(e,a){o.options.onPopulationError?t.getCallback(o.options.onPopulationError)(o,e,a):alert("Loading select items failed (URL: '"+String(i.httpGet.url)+"\nError: "+a)})}t.insideModel&&void 0===t.agGridData_model.selected&&(t.agGridData_model.selected=t.find_in_initialData(t.insideModel))}else console.log("dynamicSelectController.populateinitialData(key:"+o.key+") : No options set, needed for dynamic selects")},t.find_in_initialData=function(e){for(n=0;n<t.form.initialData.length;n++)if(t.form.initialData[n].value==e)return{item:t.form.initialData[n],index:n}}}]);